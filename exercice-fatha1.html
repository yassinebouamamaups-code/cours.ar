<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Exercice Fatha</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">

<style>

body{
  margin:0;
  font-family:Arial, sans-serif;
  text-align:center;
  background:#fff;
}

/* Bandeau */
.band{
  background:#000;
  color:white;
  max-width:700px;
  margin:25px auto;
  padding:20px;
  border-radius:15px;

  display:grid;
  grid-template-columns:1fr 60px;
  align-items:center;
}
/* Tableau 3x3 */
.table-line{
  display:flex;
  gap:15px;
  direction:rtl;
}

.group{
  display:flex;
  gap:10px;
}
/* Zone lettres */
.letters{
  display:flex;
  justify-content:center;
  gap:20px;
  direction:rtl;
}

/* Lettre */
.letter{
  position:relative;
  font-family:"Amiri", serif;
  font-size:55px;
  width:45px;
  height:65px;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* Base */
.base{
  position:relative;
  z-index:2;
}

/* Fatha */
.haraka{
  position:absolute;
  top:-10px;
  font-size:30px;
  z-index:3;
}

/* Surbrillance */
.letter.active{
  background:#ffeaa7;
  color:black;
  border-radius:6px;
  box-shadow:none;
}

/* Bouton */
.play{
  background:transparent;
  border:2px solid white;
  color:white;
  border-radius:8px;
  font-size:18px;
  cursor:pointer;
}

.play:hover{
  background:rgba(255,255,255,0.2);
}
/* Bloc de 3 lettres */
.group{
  background:rgba(255,255,255,0.08);
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.3);
}

/* Tableau mieux centr√© */
.table-line{
  justify-content:center;
}

/* ===== MODE MOBILE ===== */
@media (max-width: 600px){

 @media (max-width: 450px){

  .letter{
    font-size:30px;
    width:26px;
    height:40px;
  }

  .haraka{
    font-size:18px;
    top:-5px;
  }

  .group{
    gap:4px;
    padding:4px 6px;
  }

  .table-line{
    gap:6px;
  }

  .letters{
    gap:6px;
  }

  .play{
    font-size:12px;
    padding:3px 5px;
  }

  .band{
    padding:8px;
  }

  h1{
    font-size:22px;
  }
}
</style>
</head>

<body>

<h1>üìù Exercice Fatha</h1>


<!-- ===== BANDEAU 1 ===== -->

<div class="band">
  <div class="letters" id="band1"></div>
  <button class="play" onclick="playLine('band1')">‚ñ∂</button>
</div>


<!-- ===== BANDEAU 2 ===== -->

<div class="band">
  <div class="letters" id="band2"></div>
  <button class="play" onclick="playLine('band2')">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 3 ===== -->
<div class="band">
    
  <div class="letters" id="band3"></div>
  <button class="play" onclick="playLine('band3')">‚ñ∂</button>
</div>

<!-- ===== BANDEAU 4 ===== -->
<div class="band">
  <div class="letters" id="band4"></div>
  <button class="play" onclick="playLine('band4')">‚ñ∂</button>
</div>

<!-- ===== BANDEAU 5 ===== -->
<div class="band">
  <div class="letters" id="band5"></div>
  <button class="play" onclick="playLine('band5')">‚ñ∂</button>
</div>

<!-- ===== BANDEAU 6 ===== -->
<div class="band">
  <div class="letters" id="band6"></div>
  <button class="play" onclick="playLine('band6')">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 7 ===== -->
<div class="band">
  <div class="letters" id="band7"></div>
  <button class="play" onclick="playLine('band7')">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 8 ===== -->
<div class="band">
  <div class="letters" id="band8"></div>
  <button class="play" onclick="playLine('band8')">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 9 ===== -->
<div class="band">
  <div class="letters" id="band9"></div>
  <button class="play" onclick="playLine('band9')">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 10 ===== -->
<div class="band">
  <div class="letters" id="band10"></div>
  <button class="play" onclick="playLine('band10')">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 11 ===== -->
<div class="band">
  <div class="letters" id="band11"></div>
  <button class="play" onclick="playLine('band11')">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 12 ===== -->
<div class="band">
  <div class="letters" id="band12"></div>
  <button class="play" onclick="playLine('band12')">‚ñ∂</button>
</div>


<script>
/* ================= AUDIO ================= */

const audio = new Audio("fatha_isma.mp3");
let timer = null;


/* ================= SONS ================= */

const sounds = {
  "ÿß": { start:0.8, d:0.8 },
  "ÿ®": { start:1.6, d:0.8 }
};


/* ================= DONN√âES ================= */

/* Ordre p√©dagogique (logique) */
const band1Data = ["ÿ®","ÿß"];

const band2Data = [
  "ÿ®","ÿß","ÿß","ÿ®","ÿß","ÿ®","ÿ®","ÿß","ÿ®","ÿß"
];
const band3Data = ["ÿß","ÿ®","ÿß", "ÿß", "ÿ®","ÿ®", "ÿß","ÿß","ÿ®"
];
const band4Data = ["ÿ®","ÿ®","ÿß", "ÿß","ÿ®","ÿ®","ÿ®","ÿß","ÿß"
];
const band5Data = ["ÿß","ÿ®","ÿ®","ÿ®","ÿß","ÿ®","ÿ®","ÿ®","ÿß"
];
const band6Data = ["ÿ®","ÿß","ÿ®","ÿß","ÿß","ÿ®","ÿß","ÿ®","ÿß"
];
const band7Data = ["ÿ®","ÿß","ÿß","ÿ®","ÿß","ÿ®","ÿß","ÿ®","ÿ®"
];
const band8Data = ["ÿ®","ÿ®","ÿß","ÿ®","ÿß","ÿß","ÿß","ÿß","ÿ®"
];
const band9Data = ["ÿ®","ÿß","ÿß","ÿß","ÿ®","ÿ®","ÿ®","ÿ®","ÿß"
];
const band10Data = ["ÿß","ÿ®","ÿß","ÿß","ÿß","ÿ®","ÿ®","ÿß","ÿ®"
];
const band11Data = ["ÿß","ÿ®","ÿ®","ÿ®","ÿß","ÿ®","ÿ®","ÿ®","ÿß"
];
const band12Data = ["ÿ®","ÿß"
];
/* ================= RENDU ================= */

function renderLine(containerId, data){

  const box = document.getElementById(containerId);
  box.innerHTML = "";

  /* Bandes 3 √† 12 = tableau */
  const bandNumber = parseInt(containerId.replace("band",""));

  if(bandNumber >= 3){

    const tableWrap = document.createElement("div");
    tableWrap.className = "table-line";

    /* D√©coupage en groupes de 3 */
    const groups = [];
    for(let i=0; i<data.length; i+=3){
      groups.push(data.slice(i,i+3));
    }

    /* RTL */
    groups.reverse().forEach(groupData=>{

      const groupDiv = document.createElement("div");
      groupDiv.className = "group";

      groupData.reverse().forEach(letter=>{

        const wrap = document.createElement("div");
        wrap.className = "letter";

        const base = document.createElement("span");
        base.className = "base";
        base.textContent = letter;

        const haraka = document.createElement("span");
        haraka.className = "haraka";
        haraka.textContent = "Ÿé";

        wrap.appendChild(base);
        wrap.appendChild(haraka);
        groupDiv.appendChild(wrap);

      });

      tableWrap.appendChild(groupDiv);

    });

    box.appendChild(tableWrap);

  }

  /* Bandes 1 & 2 = normal */
  else{

    data.slice().reverse().forEach(letter=>{

      const wrap = document.createElement("div");
      wrap.className = "letter";

      const base = document.createElement("span");
      base.className = "base";
      base.textContent = letter;

      const haraka = document.createElement("span");
      haraka.className = "haraka";
      haraka.textContent = "Ÿé";

      wrap.appendChild(base);
      wrap.appendChild(haraka);
      box.appendChild(wrap);

    });

  }

}


/* Affichage */
renderLine("band1", band1Data);
renderLine("band2", band2Data);
renderLine("band3", band3Data);
renderLine("band4", band4Data);
renderLine("band5", band5Data);
renderLine("band6", band6Data);
renderLine("band7", band7Data);
renderLine("band8", band8Data);
renderLine("band9", band9Data);
renderLine("band10", band10Data);
renderLine("band11", band11Data);
renderLine("band12", band12Data);
/* ================= PLAYER ================= */

function stop(){

  audio.pause();
  audio.currentTime = 0;

  if(timer){
    clearTimeout(timer);
    timer=null;
  }

  document
    .querySelectorAll(".letter")
    .forEach(l=>l.classList.remove("active"));
}


/* Lecture bas√©e SUR L‚ÄôAFFICHAGE (RTL correct) */

function playLine(containerId){

  stop();

  const letters =
    document.getElementById(containerId)
    .querySelectorAll(".letter");

  let i = 0;

  function playNext(){

    if(i >= letters.length) return;

    letters.forEach(l=>l.classList.remove("active"));

    const current = letters[i];
    const base = current.querySelector(".base").textContent;

    current.classList.add("active");

    const data = sounds[base];

    audio.currentTime = data.start;
    audio.play();

    /* On attend un peu PLUS longtemps */
    const duration = (data.d + 0.15) * 1000;

    timer = setTimeout(()=>{

      audio.pause();
      current.classList.remove("active");

      i++;

      timer = setTimeout(playNext, 300);

    }, duration);
  }

  playNext();
}

</script>

</body>
</html>